<!doctype html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>eyeForm - Neurobit AI</title>

    <link rel="apple-touch-icon" sizes="180x180" href="../favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon/favicon-16x16.png">
    <link rel="manifest" href="../favicon/site.webmanifest">

    <!-- <link href="https://fonts.googleapis.com/css?family=Oswald:300,400|Roboto+Mono&display=swap" rel="stylesheet"> -->
    <!-- <link rel="stylesheet" href="fonts/icomoon/style.css"> -->
    <link rel="stylesheet" href="../css/bootstrap.513.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/jquery.validate.min.js"></script>
    <script src="../js/myopia-main.js"></script>
    
        <style>
      .warning_msg {
        color: red;
        font-size: 10px;
        margin-left: 5px;
      }
      datalist {
      display: flex;
      justify-content: space-between;
      width: 100%;
      }

      option {
      padding: 0;
      }

      input[type="range"] {
      width: 100%;
      margin: 0;
      }
      
      .right-aligned {
            text-align: right;
        }

      #customDate_dateOfBirth::-webkit-calendar-picker-indicator{
          padding-left: 23px;
          padding-right:22px;

      }
      #dateOfVisit::-webkit-calendar-edit,
      #dateOfBirth::-webkit-calendar-edit{
          display:none;
      }
      #dateOfBirth::-webkit-calendar-picker-indicator{
          display:none;
      }
    </style>
  </head>

  <body class="bg-light">
    <script src="../js/jwt-decode.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      function handleCredentialResponse(response) {
        var token = response.credential;
        var decoded = jwt_decode(token);
        console.log(decoded.name);
        console.log(decoded.email);
        if(decoded.name !=="Aleistar Chan" && decoded.email !=="neurobit.tech@gmail.com" && decoded.email !=="phoebe40630@gmail.com")
        {
        document.getElementById("suggestion").style.display = "none";
        document.getElementById("uploadform").style.display = "none";
        }
        document.getElementById('name').value = decoded.name;
        document.getElementById('email').value = decoded.email;
        $('#staticBackdrop').modal('hide');
        $.ajax({
          url: 'https://aw7c8d4hh6.execute-api.ap-east-1.amazonaws.com/suggestion',
          //url: 'https://rlneiq30aa.execute-api.ap-northeast-1.amazonaws.com/DREDGE_LINE/Nautiluz-test',
          type: 'POST',
          dataType: 'json',
          data: JSON.stringify([1,2,3,4,5,6,7,8,9,10]),
          complete: function(data) {
            console.log(data['responseText']);
          }
        });
      }
      window.onload = function () {
        google.accounts.id.initialize({
          client_id: "804327021269-tvgs2une4gdpepaslb7niggg1c0pldjp.apps.googleusercontent.com",
          callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(
          document.getElementById("buttonDiv"),
          { theme: "filled_blue", size: "large", text: "continue_with" }  // customization attributes
        );
        // google.accounts.id.prompt(); // also display the One Tap dialog
      }
    </script>
    <script type="text/javascript">
      $(window).on('load', function() {
          $('#staticBackdrop').modal('show');
      });
    </script>
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">eyeForm: Myopia tracking for school-aged children</h5>
            <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
          </div>
          <div class="modal-body" id="buttonDiv">
            ...
          </div>
          <div class="modal-footer">
            Copyright © 2025 Neurobit Technologies Co., Ltd.
            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Understood</button> -->
          </div>
        </div>
      </div>
    </div>

    <div class="content">
      <div class="container">
        <div class="row justify-content-center">

              <div class="col">
                <div class="float-end form-group form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="darkMode">
                  <label class="form-check-label" for="darkMode">Dark mode</label>
                </div>
              </div>

              <form method="post" id="eyeForm" name="eyeForm">
                <input type="hidden" name="odRisk" id="odRisk">
                <input type="hidden" name="osRisk" id="osRisk">
                <input type="hidden" name="name" id="name">
                <input type="hidden" name="email" id="email">

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="medRecNo">Patient ID</label>
                    <input type="text" class="form-control" name="medRecNo" id="medRecNo">
                    <span class="warning_msg" id="medRecNo_warning"> </span>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="caseNo">Case No.</label>
                    <input type="number" class="form-control" name="caseNo" id="caseNo" disabled>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="site" id="site_info">Institution</label>
                    <select class="form-select" name="site" id="site">
                      <option value=""></option>
                      <option value="Neurobit">Neurobit</option>
                      <option value="TTT">TTT</option>
                      <option value="HHH">HHH</option>
                    </select>
                    <span class="warning_msg" id="site_warning"> </span>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="dateOfVisit">Date of visit</label>
                    <input type="date" class="form-control" name="dateOfVisit" id="dateOfVisit">
                    <span class="warning_msg" id="dateOfVisit_warning"></span>
                  </div>
                  <div class="col-5 form-group">
                    <label class="form-label" for="dateOfBirth">Date of birth</label>
                    <input type="date" class="form-control" name="dateOfBirth" id="dateOfBirth">
                    <span class="warning_msg" id="dateOfBirth_warning"></span>
                  </div>
                  <div class="col-1 form-group">
                    <label class="form-label" for="dateOfBirth"></label>
                    <input type="date" class="form-control" name="customDate_dateOfBirth" id="customDate_dateOfBirth" tabindex="-1">
                  </div>
                </div>

                <div class="row">
                  <div class="col-3 form-group">
                    <label class="form-label" for="age">Age</label>
                    <input type="text" class="form-control" name="age" id="age" disabled style="display:none;">
                    <input type="text" class="form-control" name="age_show" id="age_show" disabled>
                    <span class="warning_msg" id="ageID_warning"></span>
                  </div>
                  <div class="col-3 form-group">
                    <label class="form-label" for="height">Height (cm)</label>
                    <input type="text"  class="form-control" name="height" id="height">
                    <span id="height_errorMsg" class="warning_msg"></span>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="pretermW">Preterm week</label>
                    <div class="row g-0">
                      <div class="col-5 form-group">
                        <input type="text"  class="form-control" name="pretermW" id="pretermW">
                        <span id="week_errorMsg" class="warning_msg"></span>
                      </div>
                      <div class="col-1 form-group">
                        <label class="form-label" for="pretermW">Week</label>
                      </div>
                      <div class="col-5 form-group">
                        <input type="text" class="form-control" name="pretermD" id="pretermD" >
                        <span id="day_errorMsg" class="warning_msg"></span>
                      </div>
                      <div class="col-1 form-group">
                        <label class="form-label" for="pretermD">Day</label>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="sexM">Sex</label>
                    <input type="radio" class="form-check-input" name="sex" id="sexM" value="Male">
                    <label class="form-label" for="sexM">Male　</label>
                    <input type="radio" class="form-check-input" name="sex" id="sexF" value="Female">
                    <label class="form-label" for="sexF">Female　</label>
                    <span class="warning_msg" id="sex_warning"></span>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="birth">Fetal status</label>
                    <input type="radio" class="form-check-input" name="birth" id="birth" value="Single">
                    <label class="form-label" for="birth">Single　</label>
                    <input type="radio" class="form-check-input" name="birth" id="births" value="Multiple">
                    <label class="form-label" for="births">Multiple　</label>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="fatherD">Father：degree of myopia ≦ -5D</label>
                    <input type="number" max=-5 step=0.5 class="form-control" name="fatherD" id="fatherD">
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="motherD">Mother：degree of myopia ≦ -5D</label>
                    <input type="number" max=-5 step=0.5 class="form-control" name="motherD" id="motherD">
                  </div>
                </div>

                <br><hr style="color:red"><br>

                <div class="row">
                  <div class="col-6 form-group" style="display: none;">
                    <label class="form-label" for="od1">OD BCVA </label>
                    <label class="form-label" for="od0"> ( with glasses</label>
                    <input type="checkbox" class="form-check-input" name="od0" id="od0" value="G">
                    <label class="form-label" for="od0"> ) :</label>
                    <span class="form-range-value" id="od1value" style="width: 50px; display: inline-block;"></span>
                    <span class="warning_msg" id="od1_warning"> </span>
                    <input type="range" class="form-range" min=0 max=1 step=0.1 name="od1" id="od1" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="0.0"></option>
                      <option value="10" label="1.0"></option>
                    </datalist>
                  </div>
                  <div class="col-6 form-group" style="display: none;">
                    <label class="form-label" for="os1">OS BCVA </label>
                    <label class="form-label" for="os0"> ( with glasses</label>
                    <input type="checkbox" class="form-check-input" name="os0" id="os0" value="G">
                    <label class="form-label" for="os0"> ) :</label>
                    <span class="form-range-value" id="os1value" style="width: 50px; display: inline-block;"></span>
                    <span class="warning_msg" id="os1_warning"> </span>
                    <input type="range" class="form-range" min=0 max=1 step=0.1 name="os1" id="os1" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="0.0"></option>
                      <option value="10" label="1.0"></option>
                    </datalist>
                  </div>
                </div>
                
                <div class="row" style="display: none;">
                  <div class="col-6 form-group">
                    <label class="form-label" for="od6">OS VABC <span class="form-range-value" id="od6value" style="width: 50px; display: inline-block;"></span></label>
                    <span class="warning_msg" id="od6_warning"> </span>
                    <input type="range" class="form-range" min=0 max=1 step=0.1 name="od6" id="od6" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="0.0"></option>
                      <option value="10" label="1.0"></option>
                    </datalist>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="os6">OD VABC <span class="form-range-value" id="os6value" style="width: 50px; display: inline-block;"></span></label>
                    <span class="warning_msg" id="o62_warning"> </span>
                    <input type="range" class="form-range" min=0 max=1 step=0.1 name="os6" id="os6" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="0.0"></option>
                      <option value="10" label="1.0"></option>
                    </datalist>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="od2">OD SPH(D)  : <span class="form-range-value" id="od2value" style="width: 50px; display: inline-block;"></span></label>
                    <span class="warning_msg" id="od2_warning"> </span>
                    <input type="range" class="form-range" min=-10 max=10 step=0.25 name="od2" id="od2" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="-10"></option>
                      <option value="10" label="10"></option>
                    </datalist>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="os2">OS SPH(D)  : <span class="form-range-value" id="os2value" style="width: 50px; display: inline-block;"></span></label>
                    <span class="warning_msg" id="os2_warning"> </span>
                    <input type="range" class="form-range" min=-10 max=10 step=0.25 name="os2" id="os2" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="-10"></option>
                      <option value="10" label="10"></option>
                    </datalist>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="od3">OD CYL(D)  : <span class="form-range-value" id="od3value" style="width: 50px; display: inline-block;"></span></label>
                    <span class="warning_msg" id="od3_warning"> </span>
                    <input type="range" class="form-range" min=-7 max=0 step=0.25 name="od3" id="od3" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="-7.0"></option>
                      <option value="10" label="0.0"></option>
                    </datalist>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="os3">OS CYL(D)  : <span class="form-range-value" id="os3value" style="width: 50px; display: inline-block;"></span></label>
                    <span class="warning_msg" id="os3_warning"> </span>
                    <input type="range" class="form-range" min=-7 max=0 step=0.25 name="os3" id="os3" list="tickmarks">
                    <datalist id="tickmarks">
                      <option value="1" label="-7.0"></option>
                      <option value="10" label="0.0"></option>
                    </datalist>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="od4">OD Axis(°) </label>
                    <select class="form-select" name="od4" id="od4">
                      <option value=""></option>
                      <optgroup label="Common">
                        <option value="0">0</option>
                        <option value="90">90</option>
                        <option value="180">180</option>
                        <option value="10">10</option>
                        <option value="170">170</option>
                        <option value="20">20</option>
                        <option value="160">160</option>
                      </optgroup>
                      <optgroup label="--------------------">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                        <option value="105">105</option>
                        <option value="110">110</option>
                        <option value="115">115</option>
                        <option value="120">120</option>
                        <option value="125">125</option>
                        <option value="130">130</option>
                        <option value="135">135</option>
                        <option value="140">140</option>
                        <option value="145">145</option>
                        <option value="150">150</option>
                        <option value="155">155</option>
                        <option value="160">160</option>
                        <option value="165">165</option>
                        <option value="170">170</option>
                        <option value="175">175</option>
                      </optgroup>
                    </select>
                    <span class="warning_msg" id="od4ID_warning"> </span>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="os4">OS Axis(°) </label>
                    <select class="form-select" name="os4" id="os4">
                      <option value=""></option>
                      <optgroup label="Common">
                        <option value="0">0</option>
                        <option value="90">90</option>
                        <option value="180">180</option>
                        <option value="10">10</option>
                        <option value="170">170</option>
                        <option value="20">20</option>
                        <option value="160">160</option>
                      </optgroup>
                      <optgroup label="--------------------">
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                        <option value="105">105</option>
                        <option value="110">110</option>
                        <option value="115">115</option>
                        <option value="120">120</option>
                        <option value="125">125</option>
                        <option value="130">130</option>
                        <option value="135">135</option>
                        <option value="140">140</option>
                        <option value="145">145</option>
                        <option value="150">150</option>
                        <option value="155">155</option>
                        <option value="160">160</option>
                        <option value="165">165</option>
                        <option value="170">170</option>
                        <option value="175">175</option>
                      </optgroup>
                    </select>
                    <span class="warning_msg" id="os4ID_warning"> </span>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6 form-group">
                    <label class="form-label" for="od5int">OD AL(mm)</label>
                    <div class="row g-0">
                      <div class="col-6 form-group">
                        <select class="form-select" name="od5int" id="od5int">
                          <option value=""></option>
                          <option value="< 20">< 20</option>
                          <option value="20">20</option>
                          <option value="21">21</option>
                          <option value="22">22</option>
                          <option value="23">23</option>
                          <option value="24">24</option>
                          <option value="25">25</option>
                          <option value="26">26</option>
                          <option value="27">27</option>
                          <option value="28">28</option>
                          <option value="29">29</option>
                          <option value="30">30</option>
                          <option value="> 30">> 30</option>
                        </select>
                        <span class="warning_msg" id="od5int_warning"> </span>
                      </div>
                      <div class="col-6 form-group">
                        <select class="form-select" name="od5dec" id="od5dec">
                          <option value=".00">.00</option>
                          <option value=".01">.01</option>
                          <option value=".02">.02</option>
                          <option value=".03">.03</option>
                          <option value=".04">.04</option>
                          <option value=".05">.05</option>
                          <option value=".06">.06</option>
                          <option value=".07">.07</option>
                          <option value=".08">.08</option>
                          <option value=".09">.09</option>
                          <option value=".10">.10</option>
                          <option value=".11">.11</option>
                          <option value=".12">.12</option>
                          <option value=".13">.13</option>
                          <option value=".14">.14</option>
                          <option value=".15">.15</option>
                          <option value=".16">.16</option>
                          <option value=".17">.17</option>
                          <option value=".18">.18</option>
                          <option value=".19">.19</option>
                          <option value=".20">.20</option>
                          <option value=".21">.21</option>
                          <option value=".22">.22</option>
                          <option value=".23">.23</option>
                          <option value=".24">.24</option>
                          <option value=".25">.25</option>
                          <option value=".26">.26</option>
                          <option value=".27">.27</option>
                          <option value=".28">.28</option>
                          <option value=".29">.29</option>
                          <option value=".30">.30</option>
                          <option value=".31">.31</option>
                          <option value=".32">.32</option>
                          <option value=".33">.33</option>
                          <option value=".34">.34</option>
                          <option value=".35">.35</option>
                          <option value=".36">.36</option>
                          <option value=".37">.37</option>
                          <option value=".38">.38</option>
                          <option value=".39">.39</option>
                          <option value=".40">.40</option>
                          <option value=".41">.41</option>
                          <option value=".42">.42</option>
                          <option value=".43">.43</option>
                          <option value=".44">.44</option>
                          <option value=".45">.45</option>
                          <option value=".46">.46</option>
                          <option value=".47">.47</option>
                          <option value=".48">.48</option>
                          <option value=".49">.49</option>
                          <option value=".50">.50</option>
                          <option value=".51">.51</option>
                          <option value=".52">.52</option>
                          <option value=".53">.53</option>
                          <option value=".54">.54</option>
                          <option value=".55">.55</option>
                          <option value=".56">.56</option>
                          <option value=".57">.57</option>
                          <option value=".58">.58</option>
                          <option value=".59">.59</option>
                          <option value=".60">.60</option>
                          <option value=".61">.61</option>
                          <option value=".62">.62</option>
                          <option value=".63">.63</option>
                          <option value=".64">.64</option>
                          <option value=".65">.65</option>
                          <option value=".66">.66</option>
                          <option value=".67">.67</option>
                          <option value=".68">.68</option>
                          <option value=".69">.69</option>
                          <option value=".70">.70</option>
                          <option value=".71">.71</option>
                          <option value=".72">.72</option>
                          <option value=".73">.73</option>
                          <option value=".74">.74</option>
                          <option value=".75">.75</option>
                          <option value=".76">.76</option>
                          <option value=".77">.77</option>
                          <option value=".78">.78</option>
                          <option value=".79">.79</option>
                          <option value=".80">.80</option>
                          <option value=".81">.81</option>
                          <option value=".82">.82</option>
                          <option value=".83">.83</option>
                          <option value=".84">.84</option>
                          <option value=".85">.85</option>
                          <option value=".86">.86</option>
                          <option value=".87">.87</option>
                          <option value=".88">.88</option>
                          <option value=".89">.89</option>
                          <option value=".90">.90</option>
                          <option value=".91">.91</option>
                          <option value=".92">.92</option>
                          <option value=".93">.93</option>
                          <option value=".94">.94</option>
                          <option value=".95">.95</option>
                          <option value=".96">.96</option>
                          <option value=".97">.97</option>
                          <option value=".98">.98</option>
                          <option value=".99">.99</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-6 form-group">
                    <label class="form-label" for="os5int">OS AL(mm)</label>
                    <div class="row g-0">
                      <div class="col-6 form-group">
                        <select class="form-select" name="os5int" id="os5int">
                          <option value=""></option>
                          <option value="< 20">< 20</option>
                          <option value="20">20</option>
                          <option value="21">21</option>
                          <option value="22">22</option>
                          <option value="23">23</option>
                          <option value="24">24</option>
                          <option value="25">25</option>
                          <option value="26">26</option>
                          <option value="27">27</option>
                          <option value="28">28</option>
                          <option value="29">29</option>
                          <option value="30">30</option>
                          <option value="> 30">> 30</option>
                        </select>
                        <span class="warning_msg" id="os5int_warning"></span>
                      </div>
                      <div class="col-6 form-group">
                        <select class="form-select" name="os5dec" id="os5dec">
                          <option value=".00">.00</option>
                          <option value=".01">.01</option>
                          <option value=".02">.02</option>
                          <option value=".03">.03</option>
                          <option value=".04">.04</option>
                          <option value=".05">.05</option>
                          <option value=".06">.06</option>
                          <option value=".07">.07</option>
                          <option value=".08">.08</option>
                          <option value=".09">.09</option>
                          <option value=".10">.10</option>
                          <option value=".11">.11</option>
                          <option value=".12">.12</option>
                          <option value=".13">.13</option>
                          <option value=".14">.14</option>
                          <option value=".15">.15</option>
                          <option value=".16">.16</option>
                          <option value=".17">.17</option>
                          <option value=".18">.18</option>
                          <option value=".19">.19</option>
                          <option value=".20">.20</option>
                          <option value=".21">.21</option>
                          <option value=".22">.22</option>
                          <option value=".23">.23</option>
                          <option value=".24">.24</option>
                          <option value=".25">.25</option>
                          <option value=".26">.26</option>
                          <option value=".27">.27</option>
                          <option value=".28">.28</option>
                          <option value=".29">.29</option>
                          <option value=".30">.30</option>
                          <option value=".31">.31</option>
                          <option value=".32">.32</option>
                          <option value=".33">.33</option>
                          <option value=".34">.34</option>
                          <option value=".35">.35</option>
                          <option value=".36">.36</option>
                          <option value=".37">.37</option>
                          <option value=".38">.38</option>
                          <option value=".39">.39</option>
                          <option value=".40">.40</option>
                          <option value=".41">.41</option>
                          <option value=".42">.42</option>
                          <option value=".43">.43</option>
                          <option value=".44">.44</option>
                          <option value=".45">.45</option>
                          <option value=".46">.46</option>
                          <option value=".47">.47</option>
                          <option value=".48">.48</option>
                          <option value=".49">.49</option>
                          <option value=".50">.50</option>
                          <option value=".51">.51</option>
                          <option value=".52">.52</option>
                          <option value=".53">.53</option>
                          <option value=".54">.54</option>
                          <option value=".55">.55</option>
                          <option value=".56">.56</option>
                          <option value=".57">.57</option>
                          <option value=".58">.58</option>
                          <option value=".59">.59</option>
                          <option value=".60">.60</option>
                          <option value=".61">.61</option>
                          <option value=".62">.62</option>
                          <option value=".63">.63</option>
                          <option value=".64">.64</option>
                          <option value=".65">.65</option>
                          <option value=".66">.66</option>
                          <option value=".67">.67</option>
                          <option value=".68">.68</option>
                          <option value=".69">.69</option>
                          <option value=".70">.70</option>
                          <option value=".71">.71</option>
                          <option value=".72">.72</option>
                          <option value=".73">.73</option>
                          <option value=".74">.74</option>
                          <option value=".75">.75</option>
                          <option value=".76">.76</option>
                          <option value=".77">.77</option>
                          <option value=".78">.78</option>
                          <option value=".79">.79</option>
                          <option value=".80">.80</option>
                          <option value=".81">.81</option>
                          <option value=".82">.82</option>
                          <option value=".83">.83</option>
                          <option value=".84">.84</option>
                          <option value=".85">.85</option>
                          <option value=".86">.86</option>
                          <option value=".87">.87</option>
                          <option value=".88">.88</option>
                          <option value=".89">.89</option>
                          <option value=".90">.90</option>
                          <option value=".91">.91</option>
                          <option value=".92">.92</option>
                          <option value=".93">.93</option>
                          <option value=".94">.94</option>
                          <option value=".95">.95</option>
                          <option value=".96">.96</option>
                          <option value=".97">.97</option>
                          <option value=".98">.98</option>
                          <option value=".99">.99</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>

                <br><hr style="color:red"><br>

                <div class="row">
                  <div class="col-9 form-group">
                    <input type="radio" class="form-check-input" name="treatment" id="treatmentN" value="N" checked>
                    <label class="form-label" for="treatmentN">Untreated/Under observation　</label>
                    <input type="radio" class="form-check-input" name="treatment" id="treatmentY" value="Y">
                    <label class="form-label" for="treatmentY">Treatment procedure　</label>
                  </div>
                </div>
                <br>
                <div class="row g-2">
                  <div class="col-4 form-group">
                    <label class="form-label" for="treatment1">Glasses</label>
                    <select class="form-select" name="treatment1" id="treatment1" disabled>
                      <option value=""></option>
                      <option value="一般眼鏡">Regular_glasses</option>
                      <option value="近視控制眼鏡_Zeiss_MyoVision">Myopia_control_glasses_Zeiss_MyoVision</option>
                      <option value="近視控制眼鏡_Hoya_MiyoSmart">Myopia_control_glasses_Hoya_MiyoSmart</option>
                      <option value="近視控制眼鏡_依視路_星趣控">Myopia_control_glasses_Essilor_Stellest</option>
                      <option value="近視控制隱形眼鏡_酷柏_MiSight">Myopia_control_glasses_CooperVision_MiSight</option>
                    </select>
                  </div>
                  <div class="col-4 form-group">
                    <label class="form-label" for="treatment2">Mydriatic agent</label>
                    <select class="form-select" name="treatment2" id="treatment2" disabled>
                      <option value=""></option>
                      <option value="散瞳劑">Use Mydriaticst.</option>
                      <option value="低散瞳劑">Low-concentration Mydriaticst.</option>
                      <option value="中散瞳劑">Medium-concentration Mydriatics</option>
                      <option value="高散瞳劑">Hight-concentration Mydriatics.</option>
                    </select>
                  </div>
                  <div class="col-4 form-group">
                    <label class="form-label" for="treatment3">Ortho-K lenses</label>
                    <select class="form-select" name="treatment3" id="treatment3" disabled>
                      <option value=""></option>
                      <option value="角膜塑型片">Ortho_K_lenses</option>
                    </select>
                  </div>
                </div>

                <br><hr style="color:red"><br>

                <div class="col">
                  <div class="float-end form-group">
                    <p style="display: none;" id = "server_state_text">true</p>
                    <label id="notification01" class="form-label" for="suggestion">Reminder: Please update the automatically filled recent visit date👆</label><br>
                    <input type="submit" id="submit" value="上傳" style="display:none;" class="btn btn-outline-primary btn-rounded py-0 px-4">
                    <span class="submitting"></span>
                    <button type="button" id="suggestion" class="btn btn-outline-primary btn-rounded py-0 px-4">
                      Treatment recommendations
                    </button>
                    <button type="button" id="report1" class="btn btn-outline-primary btn-rounded py-0 px-4">
                      Axial length risk assessment
                    </button>
                    <button type="button" id="report2" class="btn btn-outline-primary btn-rounded py-0 px-4">
                      Spherical diopter risk assessment
                    </button>
                    <button type="button" id="uploadform" onclick="check_submit_form_integrity();" class="btn btn-outline-primary btn-rounded py-0 px-4">
                      upload
                    </button>
                  </div>
                </div>
                <br><br>

              </form>

              <div id="form-message-warning mt-4"></div> 
              <div id="form-message-success">
                Upload completed!
              </div>

        </div>
      </div>
    </div>
    
  <script>
    document.getElementById('eyeForm').addEventListener('keydown', function (event) {
      if (event.key === 'Enter') 
        //Prevent default submission action.
        event.preventDefault();
    });
    document.getElementById('os1value').textContent="1.0";
    document.getElementById('os1').value=1.0;
    document.getElementById('od1value').textContent="1.0";
    document.getElementById('od1').value=1.0;
    var darkMode = document.getElementById('darkMode');
    darkMode.onclick = function() {
      if (darkMode.checked) {
        document.body.classList.remove('bg-light');
        document.body.classList.add('bg-dark');
        document.body.classList.add('text-light');
      } else {
        document.body.classList.remove('bg-dark');
        document.body.classList.remove('text-light');
        document.body.classList.add('bg-light');
      }
    };

    var medRecNo = document.getElementById("medRecNo");
    medRecNo.onclick = function() {
      document.getElementById('site').value = '';
      document.getElementById('caseNo').value = '';
    }

    var site = document.getElementById("site");
    site.onchange = function() {
      localStorage.clear();
      if (document.getElementById('email').value)
      {
      (document.getElementById('site_info')).textContent="Institution(Loading...)";
      $.ajax({
        url: `https://script.google.com/macros/s/AKfycby1eLmiT7l1x7UQ6hB2KxHTlYmXpkm87t3Zn4NH5A2Btqo-knqaC5NzLT09X5mo6Mss/exec?medRecNo=${medRecNo.value}&site=${site.value}`,
        type: 'GET',
        dataType: 'json',
        success: function(data) {
          if (typeof data === 'object') {
            (document.getElementById('site_info')).textContent="Institution(Past medical records have been found.)";
            localStorage.setItem('records', JSON.stringify(data));
            document.getElementById('caseNo').value = data[0][0];
            document.getElementById('dateOfBirth').value = new Date(Date.parse(data[0][2])+8*60*60*1000).toISOString().split('T')[0];
            document.getElementById('dateOfVisit').value = new Date(Date.parse(data[0][10])+8*60*60*1000).toISOString().split('T')[0];
            document.getElementById('age').value = data[0][11];
            document.getElementById('height').value = data[0][12];
            document.getElementById('pretermW').value = data[0][6];
            document.getElementById('pretermD').value = data[0][7];
            if (data[0][3] == '男' || data[0][3] == 'Male')
              document.getElementById('sexM').checked = true;
            if (data[0][3] == '女' || data[0][3] == 'Female')
              document.getElementById('sexF').checked = true;
            if (data[0][4] == '單' || data[0][4] == 'Single')
              document.getElementById('birth').checked = true;
            if (data[0][4] == '多' || data[0][4] == 'Multiple')
              document.getElementById('births').checked = true;
            document.getElementById('fatherD').value = data[0][8];
            document.getElementById('motherD').value = data[0][9];
            if (data[0][13] == 'G')
              document.getElementById('od0').checked = true;
            document.getElementById('od1').value = data[0][14];
            document.getElementById('od2').value = data[0][15];
            document.getElementById('od3').value = data[0][16];
            document.getElementById('od4').value = data[0][17];
            document.getElementById('od5int').value = parseInt(data[0][18]);
            document.getElementById('od5dec').value = (data[0][18] - parseInt(data[0][18])).toFixed(2).toString().substring(1);
            if (data[0][19] == 'G')
              document.getElementById('os0').checked = true;
            document.getElementById('os1').value = data[0][20];
            document.getElementById('os2').value = data[0][21];
            document.getElementById('os3').value = data[0][22];
            document.getElementById('os4').value = data[0][23];
            document.getElementById('os5int').value = parseInt(data[0][24]);
            document.getElementById('os5dec').value = (data[0][24] - parseInt(data[0][24])).toFixed(2).toString().substring(1);
            outputs['od1value'].innerHTML = (data[0][14] === '')?'❓':data[0][14].toFixed(1);
            outputs['od2value'].innerHTML = (data[0][15] === '')?'❓':data[0][15].toFixed(2);
            outputs['od3value'].innerHTML = (data[0][16] === '')?'❓':data[0][16].toFixed(2);
            outputs['os1value'].innerHTML = (data[0][20] === '')?'❓':data[0][20].toFixed(1);
            outputs['os2value'].innerHTML = (data[0][21] === '')?'❓':data[0][21].toFixed(2);
            outputs['os3value'].innerHTML = (data[0][22] === '')?'❓':data[0][22].toFixed(2);
            document.getElementById('dateOfBirth').oninput();
          }
          else {
            (document.getElementById('site_info')).textContent="Institution(Please fill in the new medical record)";
            localStorage.setItem('records', JSON.stringify([]));
            document.getElementById('caseNo').value = data;
          }
        }
      });
      }
    }

    var heightValid=document.getElementById('height');
    heightValid.addEventListener('input', function() {
    const pattern=/^(\d{1,4})(\.\d{0,4})?$/;
    if(this.value == '')
      height_errorMsg.textContent= '';
    else if(!pattern.test(this.value))
    {
      height_errorMsg.textContent= '请输入大于或等于 0 的有效数字。';
      heightValid.value=this.value.slice(0,this.value.length-1);
    }
    else 
    {
      let [, integerPart, decimalPart] = this.value.match(pattern);
      if (integerPart.length > 3) 
      {
        height_errorMsg.textContent = "整数部分最多3位";
        heightValid.value=integerPart.slice(0, 3);
      } 
      else 
      {
        if (decimalPart && decimalPart.length > 3) 
        {
          
          height_errorMsg.textContent = "小数部分最多2位";
          decimalPart=decimalPart.slice(0, 3);
          heightValid.value=integerPart+decimalPart;
        } 
        else 
        {
          height_errorMsg.textContent = "";
        }
      }
    }

    });

    var pretermWValid=document.getElementById('pretermW');
    pretermWValid.addEventListener('input', function() {
    const pattern=/^\d{1,2}$/;
    if(!pattern.test(this.value))
    {
      if(isNaN(this.value))
      {
        week_errorMsg.textContent= '请输入有效数字';
        pretermWValid.value=this.value.slice(0,this.value.length-1);
      }
      else 
      {
        if(parseInt(this.value)>42)
        {
          week_errorMsg.textContent= '请输入 0 到 42 之间的整数。';
          pretermWValid.value='42';
        }
        else if(parseInt(this.value)<0)
        {
          week_errorMsg.textContent= '请输入 0 到 42 之间的整数。';
          pretermWValid.value='0';
        }
      }
    }
    else
    {
      if(parseInt(this.value)>42)
        {
          week_errorMsg.textContent= '请输入 0 到 42 之间的整数。';
          pretermWValid.value='42';
        }
        else if(parseInt(this.value)<0)
        {
          week_errorMsg.textContent= '请输入 0 到 42 之间的整数。';
          pretermWValid.value='0';
        }
        else
          week_errorMsg.textContent= '';
    }
  });

    var pretermDValid=document.getElementById('pretermD');
    pretermDValid.addEventListener('input', function() {
    const pattern=/^[0-6]$/;
    if(this.value == '')
      day_errorMsg.textContent= '';
    else if(!pattern.test(this.value))
    {
      if(isNaN(this.value))
      {
        day_errorMsg.textContent= '请输入有效数字。';
        pretermDValid.value='';
      }
      else 
      {
        if(parseInt(this.value)>6)
        {
        day_errorMsg.textContent= '请输入 0 到 6 之间的整数。';
        pretermDValid.value='6';
        }
        else if (parseInt(this.value)<0)
        {
          day_errorMsg.textContent= '请输入 0 到 6 之间的整数。';
          pretermDValid.value='0';
        }
        else if (this.value.length>1)
          pretermDValid.value='0';
      }
      //pretermDValid.value=''
    }
    else
    {
        if(parseInt(this.value)>6)
        {
        day_errorMsg.textContent= '请输入 0 到 6 之间的整数。';
        pretermDValid.value='6';
        }
        else if (parseInt(this.value)<0)
        {
          day_errorMsg.textContent= '请输入 0 到 6 之间的整数。';
          pretermDValid.value='0';
        }
        else 
        day_errorMsg.textContent= '';
      }
      
  });
  let timer;
  var fatherDValid=document.getElementById('fatherD');
    fatherDValid.addEventListener('input', function() {
    const pattern=/^([\-])(\d{1,4})(\.\d{0,4})?$/;
    if(this.value == '')
      fatherD_errorMsg.textContent= '';
    else if (this.value != '-')
    {
      if(this.value.length==1)
      {
        fatherD_errorMsg.textContent= 'Please enter a minus sign ( - ) as the beginning.';
        fatherDValid.value=this.value.slice(0,this.value.length-1);
      }
      else if(!pattern.test(this.value))
      {
        fatherD_errorMsg.textContent= '请输入有效数字。';
        //fatherDValid.value=''
        fatherDValid.value=this.value.slice(0,this.value.length-1);
      }
      else
      {
        let [,minusPart, integerPart, decimalPart] = this.value.match(pattern);
      if (integerPart.length > 3) 
      {
        fatherD_errorMsg.textContent = "整数部分最多3位";
        fatherDValid.value=minusPart+integerPart.slice(0, 3);

      } 
      else 
      {
        if (decimalPart && decimalPart.length > 3) 
        {
          
          fatherD_errorMsg.textContent = "小数部分最多2位";
          decimalPart=decimalPart.slice(0, 3);
          fatherDValid.value=minusPart+integerPart+decimalPart;
        } 
        else 
        {
            if(parseFloat(this.value)>-5)
            {
              clearTimeout(timer);
              timer = setTimeout(function() {
                if(fatherDValid.value>-5)
                {
                fatherDValid.value=-5;
                fatherD_errorMsg.textContent =  "Please enter a number less than and equal to -5.";
                }
            }, 2000);
              //fatherDValid.value=-5;
              //fatherD_errorMsg.textContent =  "Please enter a number less than and equal to -5.";
            }
            else
              fatherD_errorMsg.textContent =  "";
        }
          
      }
      }
      }
      else
        fatherD_errorMsg.textContent = "";
      
  });

  var motherDValid=document.getElementById('motherD');
    motherDValid.addEventListener('input', function() {
      const pattern=/^([\-])(\d{1,4})(\.\d{0,4})?$/;
      if(this.value == '')
      motherD_errorMsg.textContent= '';
    else if (this.value != '-')
    {
      if(this.value.length==1)
      {
        motherD_errorMsg.textContent= 'Please enter a minus sign ( - ) as the beginning.';
        motherDValid.value=this.value.slice(0,this.value.length-1);
      }
      else if(!pattern.test(this.value))
      {
        motherD_errorMsg.textContent= '请输入有效数字。';
        //fatherDValid.value=''
        motherDValid.value=this.value.slice(0,this.value.length-1);
      }
      else
      {
        let [,minusPart, integerPart, decimalPart] = this.value.match(pattern);
      if (integerPart.length > 3) 
      {
        motherD_errorMsg.textContent = "整数部分最多3位";
        motherDValid.value=minusPart+integerPart.slice(0, 3);

      } 
      else 
      {
        if (decimalPart && decimalPart.length > 3) 
        {
          
          motherD_errorMsg.textContent = "小数部分最多2位";
          decimalPart=decimalPart.slice(0, 3);
          motherDValid.value=minusPart+integerPart+decimalPart;
        } 
        else 
        {
            if(parseInt(this.value)>-5)
            {
              clearTimeout(timer);
              timer = setTimeout(function() {
                if(motherDValid.value>-5)
                {
                  motherDValid.value=-5;
                  motherD_errorMsg.textContent =  "Please enter a number less than and equal to -5.";
                }
              }, 2000);
              //motherDValid.value=-5;
              //motherD_errorMsg.textContent =  "Please enter a number less than and equal to -5.";
            }
            else
              motherD_errorMsg.textContent =  "";
        }
      }
      }
      }
      else
      motherD_errorMsg.textContent = "";
  });
 
    var dateOfVisit = document.getElementById('dateOfVisit');
    var dateOfBirth = document.getElementById('dateOfBirth');
    var customDate_dateOfBirth = document.getElementById('customDate_dateOfBirth');
      const threeYearsAgo = new Date();
      const current_day = threeYearsAgo.toISOString().split('T')[0];
      customDate_dateOfBirth.max = current_day;
      dateOfBirth.max = current_day;
      dateOfVisit.max = current_day;
      threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);
      threeYearsAgo.setMonth(0); 
      threeYearsAgo.setDate(1); 
      const formattedDate = threeYearsAgo.toISOString().split('T')[0];
      customDate_dateOfBirth.value=  formattedDate;

    customDate_dateOfBirth.oninput = function() {
      if (!isNaN(Date.parse(customDate_dateOfBirth.value)))
      {
        dateOfBirth.value=customDate_dateOfBirth.value;
        dateOfBirth.oninput();
      }
    }

    dateOfVisit.oninput = function() {
      if (!isNaN(Date.parse(dateOfVisit.value)) && !isNaN(Date.parse(dateOfBirth.value))) {
        var dov = dateOfVisit.value.split('-');
        var dob = dateOfBirth.value.split('-');
        year = parseInt(dov[0]) - parseInt(dob[0]);
        month = parseInt(dov[1]) - parseInt(dob[1]);
        console.log(year);
        console.log(month);
        if (parseInt(dov[2]) - parseInt(dob[2]) < 0) {
          month--;
        }
        if (month < 0) {
          year--;
          month += 12;
        }
        document.getElementById('age').value = year + '歲' + month + '個月';
        document.getElementById('age_show').value= year + 'y' + month + 'm';
      }
    }
    dateOfBirth.oninput = function() {
      if( !isNaN(Date.parse(dateOfBirth.value)) )
        customDate_dateOfBirth.value=dateOfBirth.value

      if (!isNaN(Date.parse(dateOfVisit.value)) && !isNaN(Date.parse(dateOfBirth.value))) {
        var dov = dateOfVisit.value.split('-');
        var dob = dateOfBirth.value.split('-');
        year = parseInt(dov[0]) - parseInt(dob[0]);
        month = parseInt(dov[1]) - parseInt(dob[1]);
        console.log(year);
        console.log(month);
        if (parseInt(dov[2]) - parseInt(dob[2]) < 0) {
          month--;
        }
        if (month < 0) {
          year--;
          month += 12;
        }
        document.getElementById('age').value = year + '歲' + month + '個月';
        document.getElementById('age_show').value= year + 'y' + month + 'm';
      }
    }

    var sliders = document.getElementsByClassName("form-range");
    var outputs = document.getElementsByClassName("form-range-value");
    for (var i = 0; i < sliders.length; i++) {
      sliders[i].oninput = function() {
        var digits = 2;
        if(this.id[2] == 1) digits = 1;
        if(this.id[2] == 4) digits = 0;
        outputs[this.id+'value'].innerHTML = Number.parseFloat(this.value).toFixed(digits);
      }
    }
    
    var od5int = document.getElementById("od5int");
    od5int.onchange = function() {
      $('#od5dec').prop('disabled', (od5int.value >= 20 && od5int.value <= 30)?false:true);
    }
    var os5int = document.getElementById("os5int");
    os5int.onchange = function() {
      $('#os5dec').prop('disabled', (os5int.value >= 20 && os5int.value <= 30)?false:true);
    }

    var treatmentN = document.getElementById("treatmentN");
    treatmentN.onclick = function() {
      $('#treatment1').prop('disabled', true);
      $('#treatment2').prop('disabled', true);
      $('#treatment3').prop('disabled', true);
    }
    var treatmentY = document.getElementById("treatmentY");
    treatmentY.onclick = function() {
      $('#treatment1').prop('disabled', false);
      $('#treatment2').prop('disabled', false);
      $('#treatment3').prop('disabled', false);
    }

    function treatments(treatment1, treatment2, treatment3) {
      document.getElementById('treatment1').value = treatment1;
      document.getElementById('treatment2').value = treatment2;
      document.getElementById('treatment3').value = treatment3;
    }
    
    var label = document.getElementById("notification01");

    function check_value_func(check_value)
    {
      if (check_value == '' || check_value == null) 
        return true;
     else 
        return false;
    }

    function check_submit_form_integrity()
    {
      var check=true;
      if(check_value_func(document.getElementById('medRecNo').value))
          { 
            check=false;
            (document.getElementById('medRecNo_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('medRecNo_warning')).textContent="";
          }
      if(check_value_func(document.getElementById('site').value))
          { 
            check=false;
            (document.getElementById('site_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('site_warning')).textContent="";     
          }
          if (isNaN(Date.parse(dateOfVisit.value)))
      { 
            check=false;
            (document.getElementById('dateOfVisit_warning')).textContent="⚠️Required field";
          }
      else
          {
            if (!isNaN(Date.parse(dateOfBirth.value)))
            {
              if (year >= 0)
              {
                (document.getElementById('dateOfVisit_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="";
              }
              else
              {
                check=false;
                (document.getElementById('dateOfVisit_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="⚠️Age cannot be negative.";
              }
            }
            else
            {
              (document.getElementById('dateOfVisit_warning')).textContent="";
              (document.getElementById('ageID_warning')).textContent="";
            }
          }
          if (isNaN(Date.parse(dateOfBirth.value)))
      { 
            check=false;
            (document.getElementById('dateOfBirth_warning')).textContent="⚠️Required field";
          }
      else
          {
            if (!isNaN(Date.parse(dateOfVisit.value)) )
            {
              if (year >= 0)
              {
                (document.getElementById('dateOfBirth_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="";
              }
              else
              {
                check=false;
                (document.getElementById('dateOfBirth_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="⚠️Age cannot be negative.";
              }
            }
            else
            {
              (document.getElementById('dateOfBirth_warning')).textContent="";
              (document.getElementById('ageID_warning')).textContent="";
            }
          }
          (document.getElementById('sex_warning')).textContent="";
          (document.getElementById('od4ID_warning')).textContent="";
          (document.getElementById('os4ID_warning')).textContent="";
          (document.getElementById('od5int_warning')).textContent="";
          (document.getElementById('os5int_warning')).textContent="";

    var submitbotton=document.getElementById('submit');
          if(check)
          submitbotton.click();
          else
          window.scrollTo(0, 0);
      return check;
    }

    function check_spherical_diopter_form_integrity()
    {
      var check=true;

      if(check_value_func(document.getElementById('od4').value))
          { 
            check=false;
            (document.getElementById('od4ID_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('od4ID_warning')).textContent="";
          }       
      if(check_value_func(document.getElementById('os4').value))
          { 
            check=false;
            (document.getElementById('os4ID_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('os4ID_warning')).textContent="";
          }
      (document.getElementById('od5int_warning')).textContent="";
      (document.getElementById('os5int_warning')).textContent="";
      return check;
    }

    function check_axial_length_form_integrity()
    {
      var check=true;

      (document.getElementById('od4ID_warning')).textContent="";
      (document.getElementById('os4ID_warning')).textContent="";
      if(check_value_func(document.getElementById('od5int').value))
      { 
            check=false;
            (document.getElementById('od5int_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('od5int_warning')).textContent="";
          }  
      if(check_value_func(document.getElementById('os5int').value))
      { 
            check=false;
            (document.getElementById('os5int_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('os5int_warning')).textContent="";
          }  

       return check;
    }

    function check_form_integrity()
    {
      var check=true;
      if(check_value_func(document.getElementById('medRecNo').value))
          { 
            check=false;
            (document.getElementById('medRecNo_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('medRecNo_warning')).textContent="";
          }
      if(check_value_func(document.getElementById('site').value))
          { 
            check=false;
            (document.getElementById('site_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('site_warning')).textContent="";     
          }
  
          if (isNaN(Date.parse(dateOfVisit.value)))
      { 
            check=false;
            (document.getElementById('dateOfVisit_warning')).textContent="⚠️Required field";
          }
      else
          {
            if (!isNaN(Date.parse(dateOfBirth.value)))
            {
              if (year >= 0)
              {
                (document.getElementById('dateOfVisit_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="";
              }
              else
              {
                check=false;
                (document.getElementById('dateOfVisit_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="⚠️Age cannot be negative.";
              }
            }
            else
            {
              (document.getElementById('dateOfVisit_warning')).textContent="";
              (document.getElementById('ageID_warning')).textContent="";
            }
          }
          if (isNaN(Date.parse(dateOfBirth.value)))
      { 
            check=false;
            (document.getElementById('dateOfBirth_warning')).textContent="⚠️Required field";
          }
      else
          {
            if (!isNaN(Date.parse(dateOfVisit.value)) )
            {
              if (year >= 0)
              {
                (document.getElementById('dateOfBirth_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="";
              }
              else
              {
                check=false;
                (document.getElementById('dateOfBirth_warning')).textContent="";
                (document.getElementById('ageID_warning')).textContent="⚠️Age cannot be negative.";
              }
            }
            else
            {
              (document.getElementById('dateOfBirth_warning')).textContent="";
              (document.getElementById('ageID_warning')).textContent="";
            }
          }
      hasChecked = Array.from(document.querySelectorAll('input[name="sex"]')).some(function(element) {
        return element.checked;
      });
      if(!hasChecked)
          { 
            check=false;
            (document.getElementById('sex_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('sex_warning')).textContent="";
          }

      if (check_value_func(document.getElementById('od1value').textContent))
      { 
            check=false;
            (document.getElementById('od1_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('od1_warning')).textContent="";
          }
          if (check_value_func(document.getElementById('os1value').textContent))
      { 
            check=false;
            (document.getElementById('os1_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('os1_warning')).textContent="";
          }

          if (check_value_func(document.getElementById('od2value').textContent))
      { 
            check=false;
            (document.getElementById('od2_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('od2_warning')).textContent="";
          }
          if (check_value_func(document.getElementById('os2value').textContent))
      { 
            check=false;
            (document.getElementById('os2_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('os2_warning')).textContent="";
          }

          if (check_value_func(document.getElementById('od3value').textContent))
      { 
            check=false;
            (document.getElementById('od3_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('od3_warning')).textContent="";
          }
          if (check_value_func(document.getElementById('os3value').textContent))
      { 
            check=false;
            (document.getElementById('os3_warning')).textContent="⚠️Required field";
          }
      else
          {
            (document.getElementById('os3_warning')).textContent="";
          }
          
      return check;
    }

    var server_state_t=document.getElementById('server_state_text');

    async function check_server_live()
    {
      var counter = 0;
      server_state_t.textContent="true";
      console.log(' 分析前狀態    ', server_state_t.textContent);
      while (counter < 3 )
      {
        try{
        await $.ajax({
          url: 'https://aw7c8d4hh6.execute-api.ap-east-1.amazonaws.com/suggestion',//"{\"message\":\"Internal Server Error\"}"
          type: 'POST',
          dataType: 'json',
          data: JSON.stringify([1,2,3,4,5,6,7,8,9,10]),
          complete: function(data) {
            suggestion = data['responseText'];
            console.log(suggestion);
            if(suggestion.indexOf('{"message":"Internal Server Error"}')!== -1)
            {
              $('#server_state_text').text('false');
              console.log("Server is going to live.",$('#server_state_text').text());
            }
            else
              $('#server_state_text').text('true');
          }
      });
      }
      catch (error_message) {
        //$('#server_state_text').text('false');
        console.log("Server state is  " , error_message );
      }
      console.log(" check_server_live 單次分析結尾" , server_state_t.textContent);
      if(server_state_t.textContent === "true")
        counter = counter + 3;
      else
      {
        await delay(5000);
        counter = counter + 1;
        label.textContent = "Server analysis in progress.";
        console.log(" check_server_live 單次分析結尾",server_state_t.textContent);
      }
      }
      return 0;
    }

    function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
    }

    var suggestion = document.getElementById("suggestion");
    suggestion.onclick = async function() {
      if(check_form_integrity() & check_spherical_diopter_form_integrity())
    {
      features = [];
      if (document.getElementById('sexM').checked) features.push(1);
      if (document.getElementById('sexF').checked) features.push(0);
      if (document.getElementById('age').value) features.push(year + month/12);
      features.push(parseFloat(document.getElementById('od1').value));
      features.push(parseFloat(document.getElementById('od2').value));
      features.push(parseFloat(document.getElementById('od3').value));
      if (document.getElementById('od4').value)
      features.push(parseFloat(document.getElementById('od4').value));
      features.push(parseFloat(document.getElementById('os1').value));
      features.push(parseFloat(document.getElementById('os2').value));
      features.push(parseFloat(document.getElementById('os3').value));
      if (document.getElementById('os4').value)
      features.push(parseFloat(document.getElementById('os4').value));
      await check_server_live();

      if (features.length == 10)
      $.ajax({
        url: 'https://aw7c8d4hh6.execute-api.ap-east-1.amazonaws.com/suggestion',
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify(features),
        complete: function(data) {
          suggestion = data['responseText'];
          console.log(suggestion);
          $('#treatmentY').prop('checked', true);
          $('#treatment1').prop('disabled', false);
          $('#treatment2').prop('disabled', false);
          $('#treatment3').prop('disabled', false);
          
          if (suggestion == '不處置') treatments('', '', '');
          else if (suggestion == '一般眼鏡') treatments('一般眼鏡', '', '');
          else if (suggestion == '散瞳劑') treatments('', '散瞳劑', '');
          else if (suggestion == '一般眼鏡散瞳劑') treatments('一般眼鏡', '散瞳劑', '');
          else if (suggestion == '角膜塑型片') treatments('', '', '角膜塑型片');
          else treatments('', '', '');
          
          /*
          if (suggestion == '不處置') treatments('', '', '');
          else if (suggestion == '低散瞳劑') treatments('', '低散瞳劑', '');
          else if (suggestion == '中散瞳劑') treatments('', '中散瞳劑', '');
          else if (suggestion == '高散瞳劑') treatments('', '高散瞳劑', '');
          else if (suggestion == '一般眼鏡') treatments('一般眼鏡', '', '');
          else if (suggestion == '一般眼鏡＋中散瞳劑') treatments('一般眼鏡', '中散瞳劑', '');
          else if (suggestion == '角膜塑型片') treatments('', '', '角膜塑型片');
          else treatments('', '', '');
          */

        }
      });
      label.textContent = "Fill out the form completely. The suggestion has been provided.";
    }
    else
      {
        window.scrollTo(0, 0);
        label.textContent = "Double-check to ensure all information is filled in without omissions.";
      }
    }

    var report1 = document.getElementById("report1");
    report1.onclick = async function() {
      if(check_form_integrity() & check_axial_length_form_integrity())
      {
      await check_server_live();

      localStorage.setItem('medRecNo', medRecNo.value);
      localStorage.setItem('site', site.value);
      localStorage.setItem('age', document.getElementById('age').value);
      localStorage.setItem('sex', document.querySelector('input[name="sex"]:checked').value);
      localStorage.setItem('od1', document.getElementById('od1').value);
      localStorage.setItem('os1', document.getElementById('os1').value);
      localStorage.setItem('od2', document.getElementById('od2').value);
      localStorage.setItem('os2', document.getElementById('os2').value);
      localStorage.setItem('od3', document.getElementById('od3').value);
      localStorage.setItem('os3', document.getElementById('os3').value);
      localStorage.setItem('od4', document.getElementById('od4').value);
      localStorage.setItem('os4', document.getElementById('os4').value);

      if(document.getElementById('od5int').value == "< 20")
        localStorage.setItem('od5', '19.5');
      else if (document.getElementById('od5int').value == "> 30")
        localStorage.setItem('od5', '30.5');
      else
        localStorage.setItem('od5',od5int.value+od5dec.value);

      if(document.getElementById('os5int').value  == "< 20")
       localStorage.setItem('os5', '19.5');
      else if (document.getElementById('os5int').value == "> 30")
        localStorage.setItem('os5', '30.5');
      else
        localStorage.setItem('os5',os5int.value+os5dec.value);

      localStorage.setItem('Y', year);
      localStorage.setItem('M', month);
      localStorage.setItem('report', '軸長');
      label.textContent = "Fill out the form completely. Axial length risk assessment has been provided.";
      window.open('report.html');
    }
    else
      {
        window.scrollTo(0, 0);
        label.textContent = "Double-check to ensure all information is filled in without omissions.";
      }
    }

    var report2 = document.getElementById("report2");
    report2.onclick = async function() {
      if(check_form_integrity() & check_spherical_diopter_form_integrity())
      {
      await check_server_live();
      
      localStorage.setItem('medRecNo', medRecNo.value);
      localStorage.setItem('site', site.value);
      localStorage.setItem('age', document.getElementById('age').value);
      localStorage.setItem('sex', document.querySelector('input[name="sex"]:checked').value);
      localStorage.setItem('od1', document.getElementById('od1').value);
      localStorage.setItem('os1', document.getElementById('os1').value);
      localStorage.setItem('od2', document.getElementById('od2').value);
      localStorage.setItem('os2', document.getElementById('os2').value);
      localStorage.setItem('od3', document.getElementById('od3').value);
      localStorage.setItem('os3', document.getElementById('os3').value);
      localStorage.setItem('od4', document.getElementById('od4').value);
      localStorage.setItem('os4', document.getElementById('os4').value);
 
      if(document.getElementById('od5int').value == "< 20")
        localStorage.setItem('od5', '19.5');
      else if (document.getElementById('od5int').value == "> 30")
        localStorage.setItem('od5', '30.5');
      else
        localStorage.setItem('od5',od5int.value+od5dec.value);

      if(document.getElementById('os5int').value  == "< 20")
       localStorage.setItem('os5', '19.5');
      else if (document.getElementById('os5int').value == "> 30")
        localStorage.setItem('os5', '30.5');
      else
        localStorage.setItem('os5',os5int.value+os5dec.value);

      localStorage.setItem('Y', year);
      localStorage.setItem('M', month);
      localStorage.setItem('report', '球面度數');
      label.textContent = "Fill out the form completely. Spherical diopter risk assessment has been provided.";
      window.open('report.html');
    }
    else
      {
        window.scrollTo(0, 0);
        label.textContent = "Double-check to ensure all information is filled in without omissions.";
      }
    }
  </script>
  </body>
</html>
